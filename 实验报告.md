# 实验报告（H4-Lab3）

## 小组分工：

#### 前端：

​	于康：主要负责部分界面的搭建，数据的检查显示以及与后端的交互，前端权限控制；负责服务器部署。

​	王骏飞：主要负责界面的设计以及增删改查的前后端对接，路由跳转等，同时负责测试。

#### 后端：

​	张佳洵：负责Controller层的设计，前后端接口的约定，以及阶段性对新开发的功能进行test找bug。

​	杨添淇：主要负责数据库的设计与domain层实体类的实现，service层接口的设计与实现。

## 实验设计：

#### 类图：

![74c73d09f86bee13da8861d9587b22f.png](https://s2.loli.net/2022/05/21/tuYzkfTieb3pW6v.png)

​		这是和数据库绑定的实体类类图。说明：Student和Teacher都与userAccount设置了单向一对一关系（在学生和老师方维护）。学院和专业(School、Major)，教学楼和教室(TeachingBuilding、Classroom)都设置了双向一对多(多对一)关系，并且一方使用mappedBy放弃维护。同时教师(Teaching)与课程(Course)以及课程申请(CourseApplying)都设置了单向一对多关系。此外，有选课记录类CourseSelectingRecord，其与学生和课程都维护了双向多对一关系，并在一方使用mappedBy放弃维护看，即手动实现了一个多对多关系。Authority类则是记录整体权限的实体类，存入权限名(枚举类型)和权限值的键值对。



![969e70517c0d0a8ec85f48f666bcf3a.png](https://s2.loli.net/2022/05/21/JeupWl3bVsIGnND.png)

​		这是repository类图，他们都继承了JpaRepository<T, ID>，为service层实现业务提供接口。



![7247fe329de50fa342c57ebc43f5535.png](https://s2.loli.net/2022/05/21/f7tvPmXblRcTn1z.png)

​		这是impl软件包中service层接口的实现类。



![d9b1fb83e344ed666aac9f5a9df750a.png](https://s2.loli.net/2022/05/21/uOy3oxBCtSsVUD4.png)

​		这是controller层的类图，其通过调用service提供的接口完成前端的请求并返回result。



![b6515163c74f39ec25bb4a54b4a8206.png](https://s2.loli.net/2022/05/21/gmSJ81zovs7WhFQ.png)

​		这是工具类包中定义的工具类。

​		此外，还有很多“数据包”类以及定义了枚举类型的类。

#### 代码风格：

后端：总体来说，具有较好的代码风格，类名使用大驼峰命名法，变量名与函数名使用小驼峰命名法，并且变量名的含义均明确。此外没有出现magic number。Controller层设计的时候把端口按照功能分成一个个小的Controller，每个文件的行数都不大。（200以内）

前端：前端每个部件都用div标签包装，同时几乎没有无用的数据，函数的命名也符合驼峰命名法的规则，总体来说，代码风格良好。





![42a58ffadcd893ef33e4e3137b6e76b.png](https://s2.loli.net/2022/04/19/lQBwsEFLmn18gCf.png)

![d007435dc3f71a83d1447a5e77b5ba3.png](https://s2.loli.net/2022/04/19/VYGeuw7cd1PoRHX.png)

## 问题及解决方案：

##### 1.VUE2和VUE3的选择问题

在Lab3时首次使用了VUE框架，当时在未具体了解时直接选择了最新的VUE3，VUE3的新写法造成了我们使用Element-plus的困难，VUE3的新特性也导致了在遇到问题时的难以搜索（搜索结果更常遇到VUE2的相关情形），交付完Lab3后，我们在VUE2和VUE3的选择上进行了讨论：更换为VUE2，或许可以更为灵活方便地使用，进行更多地复用，但同时也要承担更换中的付出。

解决方式：考虑到教务系统的布局，更换为VUE2后，可能也不会有非常好的方案，反而增加实现上的繁琐性；另一方面，我们更加了解了VUE3的写法，同时对VUE2中的用法更为熟练，所以Element-plus的使用也没有障碍。最终我们决定继续进行VUE3的学习，使用VUE3框架。

## 代码检查结果：

![lab3代码检查结果.png](https://s2.loli.net/2022/04/15/y4NjJ9xKEadoz7X.png)

## 软件测试

#### 单元测试

本次新添功能主要在CourseSelectingService中实现，故对其中的核心功能函数进行单元测试，检查结果及输出的Hibernate语句，均正确。

![c59dab8c0a12962c0705907b6e72168.png](https://s2.loli.net/2022/05/21/MSXaNECqfQVYcGF.png)

#### 系统测试

通过华为云的测试，把测试用例录入然后手动进行测试。测试用例的选择主要是根据文档的要求进行编写，最后都通过了测试。

![image-20220521214336870](https://s2.loli.net/2022/05/21/WCRM4A6kIPH7ObQ.png)

![image-20220521214354190](https://s2.loli.net/2022/05/21/nUoyIEeJrRLQ5b9.png)

![image-20220521214402883](https://s2.loli.net/2022/05/21/ZmLKD5jwQOeAs4I.png)

![image-20220521214410657](https://s2.loli.net/2022/05/21/QkMFYuVyG8ianOE.png)

#### 接口测试

我们使用postman进行大部分相比lab3新添加的接口的测试。

以管理员**维护上课时间段**这个场景为例，我们的流程是登录->添加上课时间段->获得所有时间->修改时间段信息->获得所有时间->删除时间段->获得所有时间，一共这样的流程。因为技术力有限，我们此次采用的是手工逐个点击，检验对应的效果是否正确。

![postman.jpg](https://s2.loli.net/2022/05/21/FqHO6ti48x17DPn.png)

## 缺陷管理

​		我们使用了华为云上的缺陷管理功能：由发现问题者创建，并在标题或简介中对所发现缺陷进行描述，然后指派给对应模块的负责人让其处理。由于我们小组在同一寝室，故很方便，直接口头通知即可。问题解决后处理人便修改缺陷状态为已解决，并可留下相关评论。

对于前端的一些仅限于交互友好性的缺陷，我们设置了比较低的优先级。对于后端的功能性问题，我们设置较高的优先级。

![缺陷管理.png](https://s2.loli.net/2022/05/21/iLCuzVE2YfRsqjx.png)

## Tag截图：



## 心得体会：

#### 前端：

于康：

随着功能需求的增多，本次lab首先将VUE组件按管理员、教师、学生进行了分类，同时完善分解了lab3的功能组件，避免了单个组件过于复杂，整体更有条理；对于element-plus的使用更为熟练，部分新功能的前端实现相较上次轻松了些；第一次尝试项目的部署，虽然过程中遇到了一些问题，但更多的还是兴奋情绪，尤其是最后成功访问到教务管理系统。

王骏飞：

这次主要是在lab3的基础上增加了一些功能，首先是上次的lab有一些功能做的不完善，比如在课表设计这里，上次用的是填写的方式比较粗糙，这次则加入了表格可以用来选择，然后在选择组件的时候也遇到过一些困难，需要多次与后端的同学进行协商，用哪个组件，传递什么数据。可以看出沟通交流是很重要的。


#### 后端:

张佳洵：

①数据交互类的复用是需要注意的，很多时候我们后端单纯为了一个接口接受前端的数据(@RequestBody)， 就定义了一个类，而且复用得不好，比如我们有这样的几个类：学年+学期、学年+学期+search字符串，学年+学期+search+分页相关信息。复用不多导致我们为了数据交互而定义的类有些多，有些冗余。

②学习使用自动化检测工具能够节约我们很多精力，比如postman，虽然目前仍然还有很多手工的地方，但是相比最原始的功能检测已经好了许多。

杨添淇：

①JPA没有提供对多对多关系中间表的便利操作，经过实践，我选择了手动写一个中间表实体类并让其与多对多的双方各维护一个双向多对一关系(并且在一方，即多对多的双方使用mappedBy放弃维护)，这样，无论是直接对中间表进行操作还是想添加额外字段都十分方便。

②本次lab我首次在实际工程中运用了算法知识，感到对现实工程项目中算法可能的应用方式有了一些遐想和感悟。在实现”可以根据课程代码、课程名称、教师模糊搜索课程“的功能中，需要对搜素结果进行排序，但由于多个结果的匹配对象(课程代码、课程名称、教师)可能不同，如何定义大于小于关系等，我难以找到合适的可以供我调用的现成的库。于是我便自己定义了相关性实现了比较相关性的函数，利用它定义大于小于关系，并简单使用了一个插入排序来对结果进行整理。

