# 实验报告（H4-Lab3）

## 小组分工：

#### 前端：

​	于康：主要负责部分界面的搭建，数据的检查显示以及与后端的交互，前端权限控制等。负责服务器部署

​	王骏飞：主要负责界面的设计以及增删改查的前后端对接，路由跳转等，同时负责测试。

#### 后端：

​	张佳洵：负责Controller层的设计，前后端接口的约定，以及阶段性对新开发的功能进行test找bug。

​	杨添淇：主要负责数据库的设计与domain层实体类的实现，service层接口的设计与实现。

## 实验设计：

#### 类图：

![1a5c21b2485c555d726bc0ad924ca4e.png](https://s2.loli.net/2022/04/15/PZyH4uzFLeBxSbR.png)

​		这是和数据库绑定的实体类类图。说明：Student和Teacher都与userAccount设置了单向一对一关系（在学生和老师方维护）。学院和专业(School、Major)，教学楼和教室(TeachingBuilding、Classroom)都设置了双向一对多(多对一)关系，并且一方使用mappedBy放弃维护。同时教师(Teaching)与课程(Course)以及课程申请(CourseApplying)都设置了单向一对多关系。Authority类则是记录整体权限的实体类，存入权限名(枚举类型)和权限值的键值对(此次只有选课权限)。

![8eec93e76ef6dbf09868fb38d8a79f8.png](https://s2.loli.net/2022/04/15/8xdn7QbPIvCuNJr.png)

​		这是repository类图，他们都继承了JpaRepository<T, ID>，为service层实现业务提供接口。

![2c7e40e98b8882aa608dd8efdb5da12.png](https://s2.loli.net/2022/04/15/V13KHMz2SiEgnXR.png)

​		这是service层接口的类图，其中软件包impl实现了这些接口。

![5a92425003762e2edef192d493f0062.png](https://s2.loli.net/2022/04/15/nwl3ym5DQL1jvUc.png)

​		这是controller层的类图，其通过调用service提供的接口完成前端的请求并返回result。

​		此外，还有很多“数据包”类以及定义了枚举类型的类。

#### 代码风格：

后端：总体来说，具有较好的代码风格，类名使用大驼峰命名法，变量名与函数名使用小驼峰命名法，并且变量名的含义均明确。此外没有出现magic number。Controller层设计的时候把端口按照功能分成一个个小的Controller，每个文件的行数都不大。（200以内）

前端：前端每个部件都用div标签包装，同时几乎没有无用的数据，函数的命名也符合驼峰命名法的规则，总体来说，代码风格良好。





![42a58ffadcd893ef33e4e3137b6e76b.png](https://s2.loli.net/2022/04/19/lQBwsEFLmn18gCf.png)

![d007435dc3f71a83d1447a5e77b5ba3.png](https://s2.loli.net/2022/04/19/VYGeuw7cd1PoRHX.png)

## 问题及解决方案：

##### 1.前端传给后端数据的代码格式问题：

因为我们本次代码相对于lab2基本上是推翻重来，前端改用了Vue框架，前后端交互出现了一些问题。之前可以使用的@RequestParm注解无法捕捉到前端传给后端的参数（网上的说法是和JSON格式或者表单有关，我们没有想清为什么），后端暂时只能使用@RequestBody注解接受前端传递的数据，这就涉及到数据包不包装的问题，导致我们传数据的格式其实不是非常统一，

传过去数据有几种格式：单独传一个数据；带有说明的数据，（如id：this.id）,打包后的数据，如果格式不匹配会导致后端接收不到数据，或者是收到空数据。

解决方案：和后端商量好要传过去的数据的格式，如果格式特殊，要特别强调。

##### 2.如果一个element的表单和一个打包起来的数据绑定，那么必须要给这个打包起来的数据里的每一个数据都进行修改，否则会导致无法传递。

解决方案：要注意必须把每一个值都有一个input，可以选择不可编辑或者不显示，但是必须要有。

##### 3.接口文档的更新速度跟不上我们的开发速度

造成这个问题的主要原因是我们并没有进行充分的预先设计，是边开发边设计边决定接口的，而不是先决定好所有的接口然后再前后端非常独立地进行开发。而且我们对于接口文档的格式暂时没有摸索出特别好的方式来，手动模拟JOSN格式的数据也比较慢（也许腾讯文档更适合，像这次一样放在代码仓库里的话每次都要push和pull挺麻烦）。

解决方式：利用寝室里线下交流方便的优势，线下直接画接口草图交流，虽然粗糙，但是的确解决了我们没有很多时间细细梳理需求和接口的问题。

## 代码检查结果：

![lab3代码检查结果.png](https://s2.loli.net/2022/04/15/y4NjJ9xKEadoz7X.png)

## 软件测试

#### 单元测试

#### 系统测试

通过华为云的测试，把测试用例录入然后手动进行测试。测试用例的选择主要是根据文档的要求进行编写，最后都通过了测试。

![image-20220521214336870](https://s2.loli.net/2022/05/21/WCRM4A6kIPH7ObQ.png)

![image-20220521214354190](https://s2.loli.net/2022/05/21/nUoyIEeJrRLQ5b9.png)

![image-20220521214402883](https://s2.loli.net/2022/05/21/ZmLKD5jwQOeAs4I.png)

![image-20220521214410657](https://s2.loli.net/2022/05/21/QkMFYuVyG8ianOE.png)

#### 接口测试

我们使用postman进行大部分相比lab3新添加的接口的测试。

以管理员**维护上课时间段**这个场景为例，我们的流程是登录->添加上课时间段->获得所有时间->修改时间段信息->获得所有时间->删除时间段->获得所有时间，一共这样的流程。因为技术力有限，我们此次采用的是手工逐个点击，检验对应的效果是否正确。

![postman.jpg](https://s2.loli.net/2022/05/21/FqHO6ti48x17DPn.png)

## 缺陷管理

​		我们使用了华为云上的缺陷管理功能：由发现问题者创建，并在标题或简介中对所发现缺陷进行描述，然后指派给对应模块的负责人让其处理。由于我们小组在同一寝室，故很方便，直接口头通知即可。问题解决后处理人便修改缺陷状态为已解决，并可留下相关评论。

对于前端的一些仅限于交互友好性的缺陷，我们设置了比较低的优先级。对于后端的功能性问题，我们设置较高的优先级。

![缺陷管理.png](https://s2.loli.net/2022/05/21/iLCuzVE2YfRsqjx.png)

## Tag截图：



## 心得体会：

#### 前端：

于康：

随着功能需求的增多，本次lab

王骏飞：

这次主要是在lab3的基础上增加了一些功能，首先是上次的lab有一些功能做的不完善，比如在课表设计这里，上次用的是填写的方式比较粗糙，这次则加入了表格可以用来选择，然后在选择组件的时候也遇到过一些困难，需要多次与后端的同学进行协商，用哪个组件，传递什么数据。可以看出沟通交流是很重要的。


#### 后端:

张佳洵：

①数据交互类的复用是需要注意的，很多时候我们后端单纯为了一个接口接受前端的数据(@RequestBody)， 就定义了一个类，而且复用得不好，比如我们有这样的几个类：学年+学期、学年+学期+search字符串，学年+学期+search+分页相关信息。复用不多导致我们为了数据交互而定义的类有些多，有些冗余。

②学习使用自动化检测工具能够节约我们很多精力，比如postman，虽然目前仍然还有很多手工的地方，但是相比最原始的功能检测已经好了许多。

杨添淇：

在双向一对多（多对一）关系中，最好（大多数情况）要在一方设置mappedBy ，以表示一方放弃维护。因为如果不这样的话，在一方remove一个多方对象，然后save，并不会删除多方数据，只会将其外键置空，若设置有不能为空，还会报错。所以总体看，大多数情况应该是要设置mappedBy，一方放弃维护的。外键使用得当能够帮助设计者简化工作，但是使用外键以及给其设定相关属性值时一定要谨慎，否则会造成难以预估的错误，不如不用。