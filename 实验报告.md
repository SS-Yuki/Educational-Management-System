# 实验报告（H4-Lab3）

## 小组分工：

#### 前端：

​	于康：主要负责部分界面的搭建，数据的检查显示以及与后端的交互，前端权限控制等。

​	王骏飞：主要负责界面的设计以及增删改查的前后端对接，路由跳转等。

#### 后端：

​	张佳洵：负责Controller层的设计，前后端接口的约定，以及阶段性对新开发的功能进行test找bug。

​	杨添淇：主要负责数据库的设计与domain层实体类的实现，service层接口的设计与实现。

## 实验设计：

#### 类图：

![1a5c21b2485c555d726bc0ad924ca4e.png](https://s2.loli.net/2022/04/15/PZyH4uzFLeBxSbR.png)

​		这是和数据库绑定的实体类类图。说明：Student和Teacher都与userAccount设置了单向一对一关系（在学生和老师方维护）。学院和专业(School、Major)，教学楼和教室(TeachingBuilding、Classroom)都设置了双向一对多(多对一)关系，并且一方使用mappedBy放弃维护。同时教师(Teaching)与课程(Course)以及课程申请(CourseApplying)都设置了单向一对多关系。Authority类则是记录整体权限的实体类，存入权限名(枚举类型)和权限值的键值对(此次只有选课权限)。

![8eec93e76ef6dbf09868fb38d8a79f8.png](https://s2.loli.net/2022/04/15/8xdn7QbPIvCuNJr.png)

​		这是repository类图，他们都继承了JpaRepository<T, ID>，为service层实现业务提供接口。

![2c7e40e98b8882aa608dd8efdb5da12.png](https://s2.loli.net/2022/04/15/V13KHMz2SiEgnXR.png)

​		这是service层接口的类图，其中软件包impl实现了这些接口。

![5a92425003762e2edef192d493f0062.png](https://s2.loli.net/2022/04/15/nwl3ym5DQL1jvUc.png)

​		这是controller层的类图，其通过调用service提供的接口完成前端的请求并返回result。

​		此外，还有很多“数据包”类以及定义了枚举类型的类。

#### 代码风格：

后端：总体来说，具有较好的代码风格，类名使用大驼峰命名法，变量名与函数名使用小驼峰命名法，并且变量名的含义均明确。此外没有出现magic number。Controller层设计的时候把端口按照功能分成一个个小的Controller，每个文件的行数都不大。（200以内）

前端：前端每个部件都用div标签包装，同时几乎没有无用的数据，函数的命名也符合驼峰命名法的规则，总体来说，代码风格良好。

#### 测试用例：

以下是我们自己设计的测试用例，具体测试过程略，均测试成功。

![测试用例截图1.png](https://s2.loli.net/2022/04/15/dnbDm5sRVNSCKgy.png)

![测试用例截图1.png](https://s2.loli.net/2022/04/15/dnbDm5sRVNSCKgy.png)

## 问题及解决方案：

##### 1.前端传给后端数据的代码格式问题：

因为我们本次代码相对于lab2基本上是推翻重来，前端改用了Vue框架，前后端交互出现了一些问题。之前可以使用的@RequestParm注解无法捕捉到前端传给后端的参数（网上的说法是和JSON格式或者表单有关，我们没有想清为什么），后端暂时只能使用@RequestBody注解接受前端传递的数据，这就涉及到数据包不包装的问题，导致我们传数据的格式其实不是非常统一，

传过去数据有几种格式：单独传一个数据；带有说明的数据，（如id：this.id）,打包后的数据，如果格式不匹配会导致后端接收不到数据，或者是收到空数据。

解决方案：和后端商量好要传过去的数据的格式，如果格式特殊，要特别强调。

##### 2.如果一个element的表单和一个打包起来的数据绑定，那么必须要给这个打包起来的数据里的每一个数据都进行修改，否则会导致无法传递。

解决方案：要注意必须把每一个值都有一个input，可以选择不可编辑或者不显示，但是必须要有。

##### 3.接口文档的更新速度跟不上我们的开发速度

造成这个问题的主要原因是我们并没有进行充分的预先设计，是边开发边设计边决定接口的，而不是先决定好所有的接口然后再前后端非常独立地进行开发。而且我们对于接口文档的格式暂时没有摸索出特别好的方式来，手动模拟JOSN格式的数据也比较慢（也许腾讯文档更适合，像这次一样放在代码仓库里的话每次都要push和pull挺麻烦）。

解决方式：利用寝室里线下交流方便的优势，线下直接画接口草图交流，虽然粗糙，但是的确解决了我们没有很多时间细细梳理需求和接口的问题。

## 代码检查结果：

![lab3代码检查结果.png](https://s2.loli.net/2022/04/15/y4NjJ9xKEadoz7X.png)

## Tag截图：





## 心得体会：

#### 前端：

于康：本次lab中，前端开始使用vue框架，实现了与后端的分离。体验到element-plus的便捷性，但也感受到vue的“难上手”，在遇到某个问题时，在网上搜索的方法由于“过时”等原因无法解决，在这次lab中也多次遇到磕绊，特别是在前端路由权限的管理上，花费了一定的时间。对于vue3的学习还在继续，已经感受到组件化开发的作用，在之后的工程中希望对vue3的使用更加熟练。

王骏飞：



#### 后端:

张佳洵：预先的设计是非常重要的。如果预先没有设计好数据库，修改主键数量或者名字后会导致目前数据库中的数据作废，测试人员需要删库重新从最基本的管理员账号、院系、专业、老师开始导入，比较废时间。如果预先没有设计好所有的功能和接口，那么开发时就难以有完善的接口文档可以参考，前端人员和后端人员之间互相的打扰会比较多。

杨添淇：在双向一对多（多对一）关系中，最好（大多数情况）要在一方设置mappedBy ，以表示一方放弃维护。因为如果不这样的话，在一方remove一个多方对象，然后save，并不会删除多方数据，只会将其外键置空，若设置有不能为空，还会报错。所以总体看，大多数情况应该是要设置mappedBy，一方放弃维护的。外键使用得当能够帮助设计者简化工作，但是使用外键以及给其设定相关属性值时一定要谨慎，否则会造成难以预估的错误，不如不用。